{% extends 'base.html' %}

{% block pre_container %}
{% endblock %}

{% block body %}
    <div class="body row">
      <div class="a-pane span">
      </div>

      <div class="content span">
      </div>
    </div>
{% endblock %}

{% block data %}
    <script type="text/javascript">
        var classifications = { {% for cls in classifications %}
          {{ cls }}: { en: '{{ classifications[cls][0] }}', he: '{{ classifications[cls][1] }}', p: [], },
        {% endfor %} };
        var classifications_order = [ {% for cls in classifications_order %}'{{ cls }}', {% endfor %} ];
    </script>
{% endblock %}

{% block logic %}
    <script type="text/javascript">

        var firmid = location.pathname.match(/\/(.*?)\//)[1];
        var projects;
        var filter;

        $(function(){
            $.getJSON( '/api/project/' + firmid + '/',
                function onProjectsJson(_projects) {
                    projects = _projects;
                    update_projects();
                    update_filter('all');
                }
            );
        });

        function classify(proj, cls ) {
            if( cls != "" ) {
                classifications[cls].p.push(proj);
            }
        }

        function update_projects() {
            /* Build the classifications global. This is a map that group all projects to
            the appropriate class (Office, Residential, etc.).
            */
            for (var index in projects ) {
                var proj = projects[index];
                classify(proj, proj.classification);
                classify(proj, proj.classification2);
                classify(proj, 'all');
            }
            for( var index in classifications_order ) {
                var cls = classifications[ classifications_order[index] ];
                var $elem = $('<div class="nav-menu-item">' + cls.he + '</div>');
                $('.a-pane').append($elem)
            }
        }

        function update_filter(_filter) {
            filter = _filter;
            for( index in classifications[filter].p ) {
                var proj = classifications[filter].p[index];
                var $projElem = $('<div class="cat-img-well"><a href="' + proj.id + '">' +
                    '<img class="cat-img" src="' + proj.front_picture_url + '">' +
                    '</a></div>\n');
                $('.content').append($projElem);
            }
        }


    </script>
{% endblock %}
